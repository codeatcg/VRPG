# VRPG
an interactive web viewer for reference pangenome graphs

|  |  |
| --- | --- |
| <img src="https://github.com/codeatcg/VRPG/blob/main/static/images/window2.png" width=600px/> | <img src="https://github.com/codeatcg/VRPG/blob/main/static/images/description3.png" width=400px/> |

Figrue on the left is based on vrpg-v0.1.1 and the path was not highlighted by arrow line. Figrue on the right is picked from drawings by latest version of vrpg.

# Description  
VRPG is an interactive web viewer for pangenome graph. It was initially designed to navigate the whole pangenome graph in reference Graph Fragment Assembly (rGFA) format. Now graph Graph Fragment Assembly (GFA v1.x) format is also supported. This is implemented by converting the GFA format to a format similar to rGFA. VRPG is fast, even for large and complex pangenome graph with many assemblies. The reference nodes are aligned along the center line of the view windows and encompassed by non-reference nodes. The reference line in the graph holds the stable coordinate system, just the traditional linear reference. It’s beneficial to scan all kinds of variations in the graph and relate them to the traditional knowledge by means of stable coordinates. A website shipping four pangenome graphs (one for yeast and three for human) is available at https://www.evomicslab.org/app/vrpg/. The Saccharomyces cerevisiae pangenome graph was generated with 163 assemblies and The three Homo sapiens pangenome graphs were constructed by <a href="https://humanpangenome.org/">HPRC</a>  by three different pipelines (Minigraph, Minigraph-CACTUS and PGGB). Users can also deploy the web application and view their own data.  

**Note:** the released version 0.1.1 is not the latest. For the latest version pangenome graphs in rGFA or GFAv1 format are all supported. Moreover a particular assembly path was highlighted by solid arrow line (denote edges) and dot line (denote nodes). The dot line encoded coverage information at the same time by different line width. The 'display mode' menue was changed to 'Layout' and a new option 'cola' was appended. Squeezed and expand was upon D3.js and cola was upon WebCola. The method to index the graph was also chaned and the server response time was improved further.    

# Installation  
Python3 (>=3.6) and pip environment are required.  

```
# For installing a historical version (v0.1.0) please access https://github.com/codeatcg/VRPG/releases and download the source code.

# install the latest version
# gcc >= 4.9
pip install Django==3.2.4  pybind11
git clone https://github.com/codeatcg/VRPG --recursive  
cd VRPG/module
make

```

# Prepare your data  

## rGFA format graph  

### Pangenome graph already exists  

The naming scheme of assembly should follow <a href="https://github.com/pangenome/PanSN-spec">PanSN prefix naming pattern</a>. Briefly, the assembly's name consists of sample name, delimiter, and haplotype name, e.g., sampleA#0. But it's a little looser in VRPG. It's not required that the haplotype name must be numeric, characters are also allowed. The assemblies to graph mapping files are also required. If these files do not exist the assembly can't be highlighted in the drawing. These files can be generated by minigraph by using command '-cxasm --vc'. Then run the following command to get files required by VRPG.  

```
Python script/vrpg_preprocess.py --rGFA all.gfa --gafList gaf_file.list --outDir out_folder --index
```

#### gaf_file.list file is formatted as follows: 

sample1#H1	sample1.H1.gaf  
sample2#0	sample2.0.gaf  
sample3#1	sample3.1.gaf  
sample3#2	sample3.2.gaf  

### Pangenome graph not exists  

Run the following command to create pangenome graph and generate files required by VRPG.  

```
Python script/vrpg_preprocess.py –-minigraph '/software/minigraph' --assList ass_file.list –-outDir out_folder --index
```

#### ass_file.list file is formatted as follows:  
sample1#H1	sample1.H1.fa  
sample2#0	sample2.0.fa  
sample3#1	sample3.1.fa  
sample3#2	sample3.2.fa  

**Note**, '/software/minigraph' represents the absolute path of minigraph executable file. Assembly in first line in file ass_file.list will be taken as reference.  

## GFA format graph

```
module/gfa2view --GFA in.gfa --ref refName --outDir output_dir --index --range 2000 --thread 10

```

# Execution  
1. Move all output files in directory 'upload' generated during data preparation to the empty folder 'upload' of VRPG.
2. Start the development server of Django  

```
python3 manage.py runserver  

If all is well you will see the output:  
Django version 3.2.4, using settings 'primers_project.settings'  
Starting development server at http://127.0.0.1:8000/  
```

3. Then open http://127.0.0.1:8000/app/vrpg/ in your browser and you will see the drawing of the pangenome graph.  

If server is running on different machine start the server by running

```
python3 manage.py runserver 0.0.0.0:8000
```
Please make sure the firewall is closed. Then open <a>http:\<IP of server\>:8000/app/vrpg/</a>.

If you are familiar with nginx or apache you can also deploy VRPG by using any of them.

# Tips
The edge can be highlighted by clicking on it. If you want to remove the highlight just click again.

