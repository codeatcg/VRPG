
# rGFA graph  
## Pangenome graph not exists  

1. Prepare assembly list  

```
sh download.testData.sh

sh prepare.asm.sh
```
2. Construct pangenome graph and build index  

```
python3 ../script/vrpg_preprocess.py --minigraph ../bin/minigraph --asmList build.asm.txt --index --xDep 50 --outDir results
```
3. Extract and index node sequences  
```
../module/nodeSeq --gfaFile results/upload/input.ref.gfa --upDir  results/upload
```
4. Add primary reference gene track  

```
../module/GraphAnno addRef --inGFF GCF_000146045.2_R64_genomic.gff.gz --upDir results/upload
```

5. Add annotation for all nodes  
```
sh prepare.gff.sh

../module/GraphAnno nodeGene --gffList build.gff.txt --upDir results/upload
```

6. Add annotation track from BED file  
```
../module/GraphAnno addBed --inBed test.track.bed --upDir results/upload
```

7. Migrate data  
```
mv results/upload/* ../upload
```

8. Start the development server  

```
python3 manage.py runserver
```
9. Visit pangenome regions  

Open http://127.0.0.1:8000/app/vrpg/ in your browser.    

## Pangenome graph alreaddy exists  

We will use the files generated by running steps given above to show how to use VRPG on the condition that graph was already constructed.  

1. Align assemblies to the graph

```
# Let's assume that data migration has not been done and input.ref.gfa still in results/upload.
mkdir mapping
minigraph -cxasm -t 10 --vc results/input.ref.gfa DBVPG6044.genome.fa.gz -o mapping/DBVPG6044.unstable.gaf
minigraph -cxasm -t 10 --vc results/input.ref.gfa DBVPG6765.genome.fa.gz -o mapping/DBVPG6765.unstable.gaf
minigraph -cxasm -t 10 --vc results/input.ref.gfa SK1.genome.fa.gz -o mapping/SK1.unstable.gaf
minigraph -cxasm -t 10 --vc results/input.ref.gfa Y12.genome.fa.gz -o mapping/Y12.unstable.gaf

```
2. Create GAF file list  

```
echo "DBVPG6765#HP0 mapping/DBVPG6765.unstable.gaf NA" >> mapping/gaf.list
echo "Y12#HP0 mapping/Y12.unstable.gaf NA" >> mapping/gaf.list
echo "SK1#HP0 mapping/SK1.unstable.gaf NA" >> mapping/gaf.list
echo "DBVPG6044#HP0 mapping/DBVPG6044.unstable.gaf NA" >> mapping/gaf.list
```

3. Build index

```
python ../script/vrpg_preprocess.py --gafList mapping/gaf.list --rGFA results/input.ref.gfa --outDir rGFA_upload --thread 5 --index --xDep 50
```

Remaining steps are same as that on the condition that graph has not been constructed.  
 
# GFA graph  
1. Transform graph and build index  

```  

# designate the primary reference name. For example, designate the reference name as 'GRCh38#0'. Note that the name must exist in the graph.  

../module/gfa2view --GFA graph.gfa --ref GRCh38#0 --outDir GFA_upload --index --range 2000 --thread 10

```
Remaining steps are same as that for rGFA graph.  






